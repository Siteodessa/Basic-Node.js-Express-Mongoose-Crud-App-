
<script src="bower_components/jquery-ui/jquery-ui.min.js"></script>
<script>
  $.widget.bridge('uibutton', $.ui.button);
</script>
<script src="bower_components/bootstrap/dist/js/bootstrap.min.js"></script>
<script src="bower_components/raphael/raphael.min.js"></script>
<script src="bower_components/jquery-sparkline/dist/jquery.sparkline.min.js"></script>
<script src="plugins/jvectormap/jquery-jvectormap-1.2.2.min.js"></script>
<script src="plugins/jvectormap/jquery-jvectormap-world-mill-en.js"></script>
<script src="bower_components/jquery-knob/dist/jquery.knob.min.js"></script>
<script src="bower_components/moment/min/moment.min.js"></script>
<script src="bower_components/bootstrap-daterangepicker/daterangepicker.js"></script>
<script src="bower_components/bootstrap-datepicker/dist/js/bootstrap-datepicker.min.js"></script>
<script src="plugins/bootstrap-wysihtml5/bootstrap3-wysihtml5.all.min.js"></script>
<script src="bower_components/jquery-slimscroll/jquery.slimscroll.min.js"></script>
<script src="bower_components/fastclick/lib/fastclick.js"></script>
<script src="dist/js/adminlte.min.js"></script>
<script src="dist/js/pages/dashboard.js"></script>
<script src="/dist/js/demo.js"></script>
        <script src="../../plugins/iCheck/icheck.min.js"></script>
        <!-- CK Editor -->
        <script src="../../bower_components/ckeditor/ckeditor.js"></script>
        <!-- Bootstrap WYSIHTML5 -->
        <script src="../../plugins/bootstrap-wysihtml5/bootstrap3-wysihtml5.all.min.js"></script>

<% if(dash_sub == 'objects') {  %>
  <script src="../../bower_components/datatables.net/js/jquery.dataTables.min.js"></script>
<script src="../../bower_components/datatables.net-bs/js/dataTables.bootstrap.min.js"></script>

  <script>


  $( document ).ready(function() {
    $(".db_group").each(function() {
    let obj = jQuery(this).find('.radion').first()
    obj.addClass('checked')
    obj.find('input').attr('checked', true)
  })
  function close_modal() {
  setTimeout(function(){
      $('button.btn.btn-outline.pull-left').click()
    }, 500)
  }
    $("#save_and_close").click(
     function(){
      let files = $('#image_uploads').val()

  // console.log(files);
      sendAjaxForm('result_form', 'form-horizontal', '/notes',  close_modal );
      return false;
    }
  );

      $("#save").click(
      function(){
        let files = $('#image_uploads').val()
  // console.log(files);
       sendAjaxForm('result_form', 'form-horizontal', '/notes');
        return false;
      }
    );
  });



  function add_row_after_save() {





  }

  function show_new_page_success() {

      $('#result_form p').html('Запись "'+result.title+'" успешно добавлена!<div class="page_added">Вы можете на нее <a href="/doma/'+result.page_link+'">Перейти</a></div>');



  }

  function sendAjaxForm(result_form, ajax_form, url, close_after) {



    var iframe0 = $('iframe#media_upload');
    var iframe_select = iframe0.contents().find('div#imagedata').text().replace(/\r?\n/g, "").replace(' ', "").replace(',', "").replace(' ', "").replace(' ', "").replace(' ', "").replace(' ', "");


      let z = $('.'+ ajax_form + ' input[name!=editor1]').serialize()
      z = decodeURI(z)
      let iframe = document.querySelector('iframe.cke_wysiwyg_frame.cke_reset');
      let iframeDocument = iframe.contentWindow.document.activeElement.innerHTML;
      z +=
      b = '&content=' + iframeDocument + '&home_background=' + iframe_select;
      console.log(iframe_select);
      console.log(z);
      $.ajax({
          url:     url,
          type:     "POST",
          dataType: "multipart/form-data",
          content: iframeDocument,
          data: z,
          success: function(response, xhr) {
            result = $.parseJSON(response);
            show_new_page_success()
             close_after ? close_after() : $('#result_form p') ;
        },
        error: function(response) {
         if (response.responseText && response.responseText !== undefined) {
    if (response.status == 200) {
      respo = JSON.parse(response.responseText);
              console.log('New post created');
              $('#result_form p').html('Запись "'+respo.title+'" успешно добавлена!<div class="page_added">Вы можете на нее <a href="/doma/'+respo.page_link+'">Перейти</a></div>').addClass('shown'); if (cb) {
       cb()
       }

      return
    }
                     let str = response.responseText.split("title:");
                    let str1 = str[1].split('"');
                    let str2 = str1[0];
                     $('#result_form p').text(str2).addClass('shown');
                  } else {
                      $('#result_form p').text('Неизвестная ошибка 0041').addClass('shown');
                  }

        }
    });
  }


    $(function () {

      var tablo =    $('#example1').DataTable({  "language": {
           "url": "//cdn.datatables.net/plug-ins/1.10.19/i18n/Russian.json"
       }})
      var tablo1 =  $('#example2').DataTable({
        'paging'      : true,
        'lengthChange': false,
        'searching'   : false,
        'ordering'    : true,
        'info'        : true,
        'autoWidth'   : false
      })
      jQuery('img.obj').each(function(){
        jQuery(this).wrap('<div class="roundy"> </div>')
      })


      jQuery('span.trash').click(function(){
        let id = jQuery(this).find('i').attr('id')
        let parent = jQuery(this).parent('td').parent('tr')
      url = '/notes/' + id + ''

        $.ajax({
            url:     url,
            id:     id,
            type:     "DELETE",
            success: function(response, xhr) {

              tablo.row(parent).remove().draw();

          },
          error: function(response) {
      console.log('error occured');
          }
      });


      })


    })







    function readURL(input) {
    if (input.files && input.files[0]) {
        var reader = new FileReader();
        reader.onload = function(e) {
            $('#imagePreview').css('background-image', 'url('+e.target.result +')');
            $('#imagePreview').hide();
            $('#imagePreview').fadeIn(650);
        }
        reader.readAsDataURL(input.files[0]);
    }
}
jQuery("#imageUpload").change(function() {
    readURL(this);
});
jQuery('input[type="checkbox"].minimal, input[type="radio"].minimal').iCheck({
  checkboxClass: 'icheckbox_minimal-blue',
  radioClass   : 'iradio_minimal-blue'
})
//Red color scheme for iCheck
jQuery('input[type="checkbox"].minimal-red, input[type="radio"].minimal-red').iCheck({
  checkboxClass: 'icheckbox_minimal-red',
  radioClass   : 'iradio_minimal-red'
})
//Flat red color scheme for iCheck
jQuery('input[type="checkbox"].flat-red, input[type="radio"].flat-red').iCheck({
  checkboxClass: 'icheckbox_flat-green',
  radioClass   : 'iradio_flat-green'
})

jQuery('.radion').on('click', function(){
jQuery(this).closest('div').find('.radion').removeClass('checked')
jQuery(this).addClass('checked')
})
$(function () {
  // Replace the <textarea id="editor1"> with a CKEditor
  // instance, using default configuration.
  CKEDITOR.replace('editor1')
  //bootstrap WYSIHTML5 - text editor
  $('.textarea').wysihtml5()
})
  </script>
 <% } %>
